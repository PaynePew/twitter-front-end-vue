{"version":3,"sources":["webpack:///./src/views/ChatPrivate.vue","webpack:///./src/views/ChatPrivate.vue?43b8","webpack:///./src/views/ChatPrivate.vue?f987"],"names":["class","users","userList","chatSubmit","ref","name","components","ChatUserList","Chatroom","data","content","currentUserId","computed","currentUser","state","authentication","activeReceiver","chatPrivate","activeChat","roomList","created","this","$socket","connect","id","sockets","privateHistory","$store","commit","privateMessage","newMessage","addMessage","mounted","$nextTick","joinPrivate","methods","senderId","emit","handleReceiver","trim","receiverId","message","includes","newMessages","RoomId","isRead","roomId","$refs","chatroomRef","scrollToggle","__exports__","render"],"mappings":"4IACOA,MAAM,8B,kHAAX,eAGM,MAHN,EAGM,CAFJ,eAAkC,GAAnBC,MAAO,EAAAC,UAAQ,kBAC9B,eAAwD,GAA7C,aAAa,EAAAC,WAAYC,IAAI,e,qIAS7B,GACbC,KAAM,cACNC,WAAY,CACVC,eAAA,KACAC,WAAA,MAEFC,KANa,WAOX,MAAO,CACLC,QAAS,GACTC,eAAgB,IAGpBC,SAAU,iCACL,eAAS,CACVC,YAAa,SAACC,GAAD,OAAWA,EAAMC,eAAeF,aAC7CG,eAAgB,SAACF,GAAD,OAAWA,EAAMG,YAAYD,gBAC7CE,WAAY,SAACJ,GAAD,OAAWA,EAAMG,YAAYC,YACzCC,SAAU,SAACL,GAAD,OAAWA,EAAMG,YAAYE,aAEtC,eAAW,CACZjB,SAAU,6BAGdkB,QAvBa,WAwBXC,KAAKC,QAAQC,UAEbF,KAAKV,cAAgBU,KAAKR,YAAYW,IAGxCC,QAAS,CACPC,eADO,SACQjB,GAEbY,KAAKM,OAAOC,OAAO,gCAAiCnB,IAGtDoB,eANO,SAMQC,GACbT,KAAKU,WAAWD,KAIpBE,QAxCa,WAyCXX,KAAKY,WAAU,WACbZ,KAAKa,YAAYb,KAAKV,mBAI1BwB,QAAS,CACPD,YADO,SACKE,GACVf,KAAKC,QAAQe,KAAK,eAAgB,CAAED,cAEtCE,eAJO,SAIQ7B,GACbY,KAAKM,OAAOC,OAAO,oCAAqCnB,IAE1DN,WAPO,SAOIO,GACJA,EAAQ6B,QAGblB,KAAKC,QAAQe,KAAK,iBAAkB,CAClC3B,UACA0B,SAAUf,KAAKV,cACf6B,WAAYnB,KAAKL,kBAGfe,WAjBC,SAiBUU,GAAS,2JACnB,EAAKtB,SAASuB,SAASD,EAAQE,YAAYC,QADxB,uBAEtB,EAAKV,YAAY,EAAKvB,eAFA,0BAIb8B,EAAQE,YAAYC,SAAW,EAAK1B,aAC7CuB,EAAQE,YAAYE,QAAS,EAC7B,EAAKvB,QAAQe,KAAK,iBAAkB,CAClC1B,cAAe,EAAKA,cACpBmC,OAAQ,EAAK5B,cARO,uBAWlB,EAAKS,OAAOC,OAAO,4BAA6Ba,GAX9B,OAaxB,EAAKM,MAAMC,YAAYC,cAAa,GAbZ,gD,iCCpE9B,MAAMC,EAA2B,IAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAE1E,gB,kCCTf,W","file":"js/chunk-0799fe4d.8b67423e.js","sourcesContent":["<template>\n  <div class=\"private-message__container\">\n    <ChatUserList :users=\"userList\" />\n    <Chatroom @chat-submit=\"chatSubmit\" ref=\"chatroomRef\" />\n  </div>\n</template>\n\n<script>\nimport ChatUserList from \"../components/ChatUserList.vue\";\nimport Chatroom from \"../components/Chatroom.vue\";\nimport { mapGetters, mapState } from \"vuex\";\n\nexport default {\n  name: \"ChatPrivate\",\n  components: {\n    ChatUserList,\n    Chatroom,\n  },\n  data() {\n    return {\n      content: \"\",\n      currentUserId: -1,\n    };\n  },\n  computed: {\n    ...mapState({\n      currentUser: (state) => state.authentication.currentUser,\n      activeReceiver: (state) => state.chatPrivate.activeReceiver,\n      activeChat: (state) => state.chatPrivate.activeChat,\n      roomList: (state) => state.chatPrivate.roomList,\n    }),\n    ...mapGetters({\n      userList: \"chatPrivate/getUserList\",\n    }),\n  },\n  created() {\n    this.$socket.connect();\n    // NavBar登出會先revoke currentUser，導致id為null，此處存入data取消computed響應\n    this.currentUserId = this.currentUser.id;\n  },\n  // vue3-sockets會在mounted階段註冊event\n  sockets: {\n    privateHistory(data) {\n      // this.$store.commit(\"chatPrivate/setPrivateUserList\", data);\n      this.$store.commit(\"chatPrivate/setPrivateHistory\", data);\n    },\n    // 註冊接收新訊息\n    privateMessage(newMessage) {\n      this.addMessage(newMessage);\n    },\n  },\n  // mounted後下一個Tick加入Private-Room\n  mounted() {\n    this.$nextTick(function () {\n      this.joinPrivate(this.currentUserId);\n    });\n  },\n\n  methods: {\n    joinPrivate(senderId) {\n      this.$socket.emit(\"privateEnter\", { senderId });\n    },\n    handleReceiver(data) {\n      this.$store.commit(\"chatPrivate/setPrivateMessageList\", data);\n    },\n    chatSubmit(content) {\n      if (!content.trim()) {\n        return;\n      }\n      this.$socket.emit(\"privateMessage\", {\n        content,\n        senderId: this.currentUserId,\n        receiverId: this.activeReceiver,\n      });\n    },\n    async addMessage(message) {\n      if (!this.roomList.includes(message.newMessages.RoomId)) {\n        this.joinPrivate(this.currentUserId);\n        return;\n      } else if (message.newMessages.RoomId === this.activeChat) {\n        message.newMessages.isRead = true;\n        this.$socket.emit(\"getRoomHistory\", {\n          currentUserId: this.currentUserId,\n          roomId: this.activeChat,\n        });\n      }\n      await this.$store.commit(\"chatPrivate/addNewMessage\", message);\n      // 新訊息動畫滾動底部\n      this.$refs.chatroomRef.scrollToggle(true);\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.private-message {\n  &__container {\n    width: 981px;\n    height: 100%;\n    display: flex;\n  }\n}\n</style>\n","import { render } from \"./ChatPrivate.vue?vue&type=template&id=3e64fc46&scoped=true\"\nimport script from \"./ChatPrivate.vue?vue&type=script&lang=js\"\nexport * from \"./ChatPrivate.vue?vue&type=script&lang=js\"\n\nimport \"./ChatPrivate.vue?vue&type=style&index=0&id=3e64fc46&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\User\\\\Work\\\\AlphaCamp\\\\Lecture-3\\\\twitter\\\\twitter-front-end-vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-3e64fc46\"]])\n\nexport default __exports__","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./ChatPrivate.vue?vue&type=style&index=0&id=3e64fc46&lang=scss&scoped=true\""],"sourceRoot":""}