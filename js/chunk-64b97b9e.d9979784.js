(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-64b97b9e"],{"244b":function(e,t,n){},6565:function(e,t,n){"use strict";n.r(t);var r=n("7a23"),a={class:"public-message__container"};function s(e,t,n,s,c,i){var o=Object(r["A"])("ChatUserList"),u=Object(r["A"])("Chatroom");return Object(r["t"])(),Object(r["g"])("div",a,[Object(r["j"])(o,{users:c.onlineUsers},null,8,["users"]),Object(r["j"])(u,{onChatSubmit:i.chatSubmit,ref:"chatroomRef"},null,8,["onChatSubmit"])])}var c=n("1da1"),i=n("5530"),o=(n("96cf"),n("b0c0"),n("d81d"),n("498a"),n("a7d5")),u=n("ffe0"),d=n("2708"),h=n("5502"),f={name:"ChatPublic",components:{ChatUserList:o["a"],Chatroom:u["a"]},data:function(){return{onlineUsers:[],currentUserId:-1}},computed:Object(i["a"])({},Object(h["d"])({currentUser:function(e){return e.authentication.currentUser}})),created:function(){var e=this;this.$socket.connect(),this.currentUserId=this.currentUser.id,window.onbeforeunload=function(){e.leavePublic(e.currentUserId)}},sockets:{publicLogin:function(e){this.updateStatus(e)},publicLogout:function(e){this.updateStatus(e)},allMessage:function(e){this.handleHistory(e)},newMessage:function(e){this.handleNewMessage(e)}},mounted:function(){this.$nextTick((function(){this.joinPublic(this.currentUserId)}))},beforeUnmount:function(){this.leavePublic(this.currentUserId)},methods:{joinPublic:function(e){this.$socket.emit("publicEnter",e)},leavePublic:function(e){this.$socket.emit("publicLeave",e)},updateStatus:function(e){var t=e[0],n=t.name,r=t.content,a={name:n,id:1e4*Math.random(),content:r,type:"notice"};this.addMessage(a),this.onlineUsers=e[1]},handleHistory:function(e){var t=e.map((function(e){var t=e.User,n=t.name,r=t.avatar,a=t.id,s=e.content,c=e.createdAt,i=e.id,o={userId:a,name:n,avatar:r,content:s,id:i,createdAt:c};return o}));this.fetchMessage(t)},handleNewMessage:function(e){var t=e[1],n=t.name,r=t.avatar,a=e[0],s=a.content,c=a.createdAt,i=a.id,o=a.UserId,u={userId:o,name:n,avatar:r,content:s,id:i,createdAt:c};this.addMessage(u)},chatSubmit:function(e){e.trim()&&this.$socket.emit("sendMessage",{content:e,id:this.currentUserId})},fetchMessage:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$store.commit("chat/setMessageList",e);case 2:t.$refs.chatroomRef.scrollToggle();case 3:case"end":return n.stop()}}),n)})))()},addMessage:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$store.commit("chat/addNewMessage",e);case 2:t.$refs.chatroomRef.scrollToggle(!0);case 3:case"end":return n.stop()}}),n)})))()}},mixins:[d["a"]]},m=(n("e18f"),n("6b0d")),l=n.n(m);const b=l()(f,[["render",s],["__scopeId","data-v-5de1fc5a"]]);t["default"]=b},e18f:function(e,t,n){"use strict";n("244b")}}]);
//# sourceMappingURL=chunk-64b97b9e.d9979784.js.map